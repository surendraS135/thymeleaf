kind: pipeline
type: docker
name: default

steps:
  - name: deploy-app
    image: docker:20.10.7-dind  # Use the Docker-in-Docker image
    settings:
      auto_cleanup: true
    environment:
      DOCKER_HOST: tcp://localhost:2375  # Set the Docker host to the DinD daemon
      DOCKER_TLS_CERTDIR: ""  # Disable TLS for simplicity in CI environments
    commands:
      - dockerd &  # Start the Docker daemon in the background
      - sleep 5  # Give the Docker daemon time to start
      - docker pull sowjanya135/drone-mvn:latest  # Pull the image
      - docker run -itd -p 8080:8086 --name drone-docker sowjanya135/drone-mvn:latest  # Run the container
